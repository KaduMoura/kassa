services:
  api:
    build:
      context: .
      dockerfile: apps/api/Dockerfile
    environment:
      - CI=true
      - NODE_ENV=production
      - MONGO_URI=${MONGO_URI}
      - CORS_ORIGIN=${CORS_ORIGIN}
      # AI Config
      - STAGE1_TIMEOUT_MS=${STAGE1_TIMEOUT_MS}
      - STAGE2_TIMEOUT_MS=${STAGE2_TIMEOUT_MS}
      - TOTAL_TIMEOUT_MS=${TOTAL_TIMEOUT_MS}
      - MAX_UPLOAD_BYTES=${MAX_UPLOAD_BYTES}
      - ADMIN_TOKEN=${ADMIN_TOKEN}
      - AI_PROVIDER=${AI_PROVIDER}
      - GEMINI_MODEL_VISION=${GEMINI_MODEL_VISION}
      - GEMINI_MODEL_RERANK=${GEMINI_MODEL_RERANK}
      - AI_RETRY_MAX=${AI_RETRY_MAX}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
    networks:
      - kassa-network

  web:
    build:
      context: .
      dockerfile: apps/web/Dockerfile
      args:
        - NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL}
    environment:
      - CI=true
      - NODE_ENV=production
      - API_URL=http://api:4000
    networks:
      - kassa-network

networks:
  kassa-network:
    driver: bridge
